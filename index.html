<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BREAK Log</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; line-height: 1.7; padding: 20px; max-width: 800px; margin: 0 auto; color: #333; }
        h1 { border-bottom: 2px solid #eee; padding-bottom: 10px; }
        #output { border: 1px solid #ddd; padding: 15px 25px; border-radius: 8px; background-color: #fdfdfd; min-height: 100px; }
        #status { font-size: 0.9em; color: #777; text-align: right; }
        .loading { text-align: center; color: #888; padding: 40px 0; }
        /* Markdownの見た目を調整 */
        #output h1, #output h2, #output h3 { border-bottom: 1px solid #eee; padding-bottom: 5px; }
        #output blockquote { border-left: 4px solid #ddd; padding-left: 15px; color: #666; margin-left: 0; }
        #output code { background-color: #f0f0f0; padding: 2px 4px; border-radius: 4px; }
        #output pre { background-color: #f0f0f0; padding: 10px; border-radius: 4px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>BREAK Log（Realtime Update）</h1>
    <div id="status">loading...</div>
    <hr>
    <div id="output">
        <p class="loading">newest debate loading...</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>

    <script>
        // ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼
        const GIST_ID = "1c9b453b53911f63ca02dac87a737735";
        // ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲

        const apiUrl = `https://api.github.com/gists/${GIST_ID}`;
        
        const outputElement = document.getElementById('output');
        const statusElement = document.getElementById('status');

        async function fetchAndUpdateGist() {
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`APIからの応答がありませんでした: ${response.statusText}`);
                }
                const data = await response.json();
                
                const filename = Object.keys(data.files)[0];
                const markdownContent = data.files[filename].content;
                
                // MarkdownをHTMLに変換し、安全な形にしてから表示
                const dirtyHtml = marked.parse(markdownContent);
                const cleanHtml = DOMPurify.sanitize(dirtyHtml);
                outputElement.innerHTML = cleanHtml;
                
                // 最終更新日時を表示
                const updatedAt = new Date(data.updated_at).toLocaleString('ja-JP');
                statusElement.textContent = `last update: ${updatedAt}`;

            } catch (error) {
                console.error("Gistの取得に失敗しました:", error);
                outputElement.innerHTML = `<p style="color: red;">議論の読み込みに失敗しました。Gist IDが正しいか確認してください。</p>`;
                statusElement.textContent = "更新エラー";
            }
        }

        // 最初に一度実行
        fetchAndUpdateGist();

        // その後、15秒ごとに内容をチェックして更新する
        setInterval(fetchAndUpdateGist, 15000); // 15000ミリ秒 = 15秒
    </script>
</body>
</html>
